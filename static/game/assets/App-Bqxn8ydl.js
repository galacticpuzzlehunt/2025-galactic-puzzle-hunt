import{aa as r,ab as re,ac as $,ad as G,ae,af as oe,ag as ie,ah as le,ai as ce,aj as ue,ak as de,al as M,am as J,an as fe,ao as he,ap as me,aq as q,ar as pe,as as ve,at as O,au as k,av as ge,aw as we,ax as a,ay as _,az as Re,aA as Se,aB as xe,aC as ye,aD as j,P as A,aE as X,aF as Q,aG as Ee,aH as Te,aI as je,aJ as Pe,aK as be,aL as Ce,aM as Le,aN as Ne,aO as _e,aP as Oe,aQ as ze,aR as Ie,aS as ke,aT as E,aU as Ae,d as L,aV as Ue,aW as Fe,aX as De,aY as Me}from"./main-BzbKcCYf.js";/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function P(){return P=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},P.apply(this,arguments)}function U(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((s,t)=>{let o=e[t];return s.concat(Array.isArray(o)?o.map(n=>[t,n]):[[t,o]])},[]))}function Ve(e,s){let t=U(e);return s&&s.forEach((o,n)=>{t.has(n)||s.getAll(n).forEach(l=>{t.append(n,l)})}),t}const Be="6";try{window.__reactRouterVersion=Be}catch{}function Ke(e,s){return oe({basename:void 0,future:P({},void 0,{v7_prependBasename:!0}),history:ie({window:void 0}),hydrationData:Ye(),routes:e,mapRouteProperties:ve,dataStrategy:void 0,patchRoutesOnNavigation:void 0,window:void 0}).initialize()}function Ye(){var e;let s=(e=window)==null?void 0:e.__staticRouterHydrationData;return s&&s.errors&&(s=P({},s,{errors:He(s.errors)})),s}function He(e){if(!e)return null;let s=Object.entries(e),t={};for(let[o,n]of s)if(n&&n.__type==="RouteErrorResponse")t[o]=new de(n.status,n.statusText,n.data,n.internal===!0);else if(n&&n.__type==="Error"){if(n.__subType){let l=window[n.__subType];if(typeof l=="function")try{let i=new l(n.message);i.stack="",t[o]=i}catch{}}if(t[o]==null){let l=new Error(n.message);l.stack="",t[o]=l}}else t[o]=n;return t}const We=r.createContext({isTransitioning:!1}),$e=r.createContext(new Map),Ge="startTransition",Y=le[Ge],Je="flushSync",H=ce[Je];function qe(e){Y?Y(e):e()}function T(e){H?H(e):e()}class Xe{constructor(){this.status="pending",this.promise=new Promise((s,t)=>{this.resolve=o=>{this.status==="pending"&&(this.status="resolved",s(o))},this.reject=o=>{this.status==="pending"&&(this.status="rejected",t(o))}})}}function Qe(e){let{fallbackElement:s,router:t,future:o}=e,[n,l]=r.useState(t.state),[i,d]=r.useState(),[h,m]=r.useState({isTransitioning:!1}),[c,u]=r.useState(),[p,w]=r.useState(),[g,y]=r.useState(),b=r.useRef(new Map),{v7_startTransition:V}=o||{},C=r.useCallback(f=>{V?qe(f):f()},[V]),B=r.useCallback((f,R)=>{let{deletedFetchers:v,flushSync:K,viewTransitionOpts:S}=R;f.fetchers.forEach((x,ne)=>{x.data!==void 0&&b.current.set(ne,x.data)}),v.forEach(x=>b.current.delete(x));let se=t.window==null||t.window.document==null||typeof t.window.document.startViewTransition!="function";if(!S||se){K?T(()=>l(f)):C(()=>l(f));return}if(K){T(()=>{p&&(c&&c.resolve(),p.skipTransition()),m({isTransitioning:!0,flushSync:!0,currentLocation:S.currentLocation,nextLocation:S.nextLocation})});let x=t.window.document.startViewTransition(()=>{T(()=>l(f))});x.finished.finally(()=>{T(()=>{u(void 0),w(void 0),d(void 0),m({isTransitioning:!1})})}),T(()=>w(x));return}p?(c&&c.resolve(),p.skipTransition(),y({state:f,currentLocation:S.currentLocation,nextLocation:S.nextLocation})):(d(f),m({isTransitioning:!0,flushSync:!1,currentLocation:S.currentLocation,nextLocation:S.nextLocation}))},[t.window,p,c,b,C]);r.useLayoutEffect(()=>t.subscribe(B),[t,B]),r.useEffect(()=>{h.isTransitioning&&!h.flushSync&&u(new Xe)},[h]),r.useEffect(()=>{if(c&&i&&t.window){let f=i,R=c.promise,v=t.window.document.startViewTransition(async()=>{C(()=>l(f)),await R});v.finished.finally(()=>{u(void 0),w(void 0),d(void 0),m({isTransitioning:!1})}),w(v)}},[C,i,c,t.window]),r.useEffect(()=>{c&&i&&n.location.key===i.location.key&&c.resolve()},[c,p,n.location,i]),r.useEffect(()=>{!h.isTransitioning&&g&&(d(g.state),m({isTransitioning:!0,flushSync:!1,currentLocation:g.currentLocation,nextLocation:g.nextLocation}),y(void 0))},[h.isTransitioning,g]),r.useEffect(()=>{},[]);let z=r.useMemo(()=>({createHref:t.createHref,encodeLocation:t.encodeLocation,go:f=>t.navigate(f),push:(f,R,v)=>t.navigate(f,{state:R,preventScrollReset:v==null?void 0:v.preventScrollReset}),replace:(f,R,v)=>t.navigate(f,{replace:!0,state:R,preventScrollReset:v==null?void 0:v.preventScrollReset})}),[t]),I=t.basename||"/",ee=r.useMemo(()=>({router:t,navigator:z,static:!1,basename:I}),[t,z,I]),te=r.useMemo(()=>({v7_relativeSplatPath:t.future.v7_relativeSplatPath}),[t.future.v7_relativeSplatPath]);return r.useEffect(()=>re(o,t.future),[o,t.future]),r.createElement(r.Fragment,null,r.createElement($.Provider,{value:ee},r.createElement(G.Provider,{value:n},r.createElement($e.Provider,{value:b.current},r.createElement(We.Provider,{value:h},r.createElement(ae,{basename:I,location:n.location,navigationType:n.historyAction,navigator:z,future:te},n.initialized||t.future.v7_partialHydration?r.createElement(Ze,{routes:t.routes,future:t.future,state:n}):s))))),null)}const Ze=r.memo(et);function et(e){let{routes:s,future:t,state:o}=e;return ue(s,void 0,o,t)}function tt(e){let{getKey:s,storageKey:t}=e;return at({getKey:s,storageKey:t}),null}var F;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(F||(F={}));var D;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(D||(D={}));function st(e){let s=r.useContext($);return s||q(!1),s}function nt(e){let s=r.useContext(G);return s||q(!1),s}function rt(e){let s=r.useRef(U(e)),t=r.useRef(!1),o=M(),n=r.useMemo(()=>Ve(o.search,t.current?null:s.current),[o.search]),l=J(),i=r.useCallback((d,h)=>{const m=U(typeof d=="function"?d(n):d);t.current=!0,l("?"+m,h)},[l,n]);return[n,i]}const W="react-router-scroll-positions";let N={};function at(e){let{getKey:s,storageKey:t}=e===void 0?{}:e,{router:o}=st(F.UseScrollRestoration),{restoreScrollPosition:n,preventScrollReset:l}=nt(D.UseScrollRestoration),{basename:i}=r.useContext(fe),d=M(),h=he(),m=me();r.useEffect(()=>(window.history.scrollRestoration="manual",()=>{window.history.scrollRestoration="auto"}),[]),ot(r.useCallback(()=>{if(m.state==="idle"){let c=(s?s(d,h):null)||d.key;N[c]=window.scrollY}try{sessionStorage.setItem(t||W,JSON.stringify(N))}catch{}window.history.scrollRestoration="auto"},[t,s,m.state,d,h])),typeof document<"u"&&(r.useLayoutEffect(()=>{try{let c=sessionStorage.getItem(t||W);c&&(N=JSON.parse(c))}catch{}},[t]),r.useLayoutEffect(()=>{let c=s&&i!=="/"?(p,w)=>s(P({},p,{pathname:pe(p.pathname,i)||p.pathname}),w):s,u=o==null?void 0:o.enableScrollRestoration(N,()=>window.scrollY,c);return()=>u&&u()},[o,i,s]),r.useLayoutEffect(()=>{if(n!==!1){if(typeof n=="number"){window.scrollTo(0,n);return}if(d.hash){let c=document.getElementById(decodeURIComponent(d.hash.slice(1)));if(c){c.scrollIntoView();return}}l!==!0&&window.scrollTo(0,0)}},[d,n,l]))}function ot(e,s){let{capture:t}={};r.useEffect(()=>{let o=t!=null?{capture:t}:void 0;return window.addEventListener("pagehide",e,o),()=>{window.removeEventListener("pagehide",e,o)}},[e,t])}const Z=()=>{const e=O(i=>i.redirectCommand),s=O(i=>i.setRedirectCommand),[t,o]=rt(),n=J(),{clientVersion:l}=k;r.useEffect(()=>{e!==null&&(n({pathname:e.path,search:t.toString()},{replace:e.replace}),s(null),(async()=>{if(!e.isManual||l===void 0)return;const i=(await(await fetch(`${k.djangoBaseUrl}client_version`)).text()).trim();l!==i&&window.location.reload()})().catch(console.error))},[e,s,t,n,l])};function it(){const e=ge();Z(),r.useEffect(()=>{},[e]);const s=we(e)&&e.status===404;return a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px",alignItems:"center",justifyContent:"center",textAlign:"center",position:"fixed",inset:"0"},children:[a.jsx("h1",{children:s?"Page not found":"Something went wrong"}),a.jsx("h4",{children:a.jsx(_,{route:"puzzles",children:"This world is imperfectâ€¦"})}),s?a.jsx("div",{children:"(This is not a puzzle. Click above to go back.)"}):a.jsxs("div",{children:["(This is not a puzzle. Try refreshing, or"," ",a.jsx("a",{href:"mailto:contact@galacticpuzzlehunt.com",children:"contact us"}),".)"]})]})}function lt(){const e=be(),s=Ce(),t=l=>!l.roundId||!(s!=null&&s[l.roundId]);if(e===null||k.devMode)return null;const o=Object.entries(e.puzzles).filter(([l,{type:i,solveTime:d}])=>i===A.STORY&&d===void 0);if(o.length===0)return null;o.sort(([l,i],[d,h])=>t(i)!=t(h)?t(i)?1:-1:i.unlockTime-h.unlockTime);const n=o[0][0];return a.jsx(X,{puzName:n,children:a.jsxs(j,{className:"cutscene-notif",seed:o[0][1].displayName,rotate:-10,children:[a.jsx(Q,{className:"cutscene-notif-icon",options:{folder:"svg",ext:".svg"},children:"ðŸŽ¬"}),a.jsx("div",{className:"cutscene-notif-content",children:"New cutscene available!"})]})})}function ct(){const e=M(),s=Re(),{puzName:t,puzData:o,desertIslandPieceId:n}=Se(),l=xe(t),i=ye();return a.jsxs("div",{className:"world-base-root",children:[a.jsxs("div",{className:"world-base-toolbar",children:[a.jsx(_,{route:"puzzles",className:"world-base-nav-link",children:a.jsx(j,{rotate:0,children:"World"})}),i&&!(o!==null&&o.type===A.STORY)?a.jsx(_,{route:"round",params:{slug:i.slug},className:"world-base-nav-link",children:a.jsx(j,{rotate:0,children:i.displayName})}):null,t&&l?a.jsx(X,{puzName:t,className:"world-base-nav-link",children:a.jsx(j,{rotate:0,seed:l,children:a.jsx(Q,{tag:"span",children:l})})}):null,n!==void 0?a.jsx(_,{route:"piece",params:{slug:`${Ee}_${n}`},className:"world-base-nav-link",children:a.jsxs(j,{rotate:0,seed:`#${n} in Desert Island`,children:["Piece ",n]})}):null,a.jsx("div",{style:{width:"1em",flexGrow:1}}),a.jsx("div",{id:"world-base-puzzle-toolbar-container"}),a.jsx("div",{id:"world-base-round-minimap-container"})]}),a.jsxs("div",{className:"world-base-main",children:[a.jsx(Te,{}),a.jsx(je,{mode:"wait",initial:!1,children:a.jsx(Pe.div,{className:"world-base-right",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},children:s!==null?r.cloneElement(s,{key:e.pathname}):null},e.pathname)})]}),o!==null&&o.type===A.STORY?null:a.jsx(lt,{})]})}const ut=Le(e=>({userLog:"",addToUserLog:s=>e(t=>({userLog:t.userLog+`
`+s})),clearLog:()=>e({userLog:""})}));function dt(){const[e,s]=r.useState(null),[t,o]=r.useState(!1),n=ut(u=>u.addToUserLog),i=ke(u=>u.getSockClient)(),d=E("index"),h=[E("wrapup"),E("wrapup_shoutouts"),E("wrapup_stats"),E("wrapup_ama")].some(u=>!!u),m=O(u=>u.setRedirectRoute);r.useEffect(()=>{if(i===null)return;const u=i.onErrorEvent.addListener(g=>{n(`Received error "${g.errCode}".`)}),p=i.addAuthEffect(()=>{n("Connected to server.")}),w=i.serverConnections[Ae.MAIN].afterDisconnectEvent.addListener(({numReconnections:g,reconnectDelayInSeconds:y})=>{g===0?n("Disconnected from server. Reconnecting..."):y<0?(s({errCode:L.CONNECTION_ERROR}),n("Reconnection failed; giving up.")):n(`Failed to reconnect. Reconnecting in ${y} seconds...`)});return()=>{u(),p(),w()}},[i,n]),r.useEffect(()=>{if(i!==null)return i.addStuckEffect(u=>{s(u)})},[i,s]),r.useEffect(()=>{d&&m({route:"puzzles",replace:!0})},[d,m]);const c=O(u=>u.setHasRouter);return r.useEffect(()=>{c(!0)},[c]),Z(),Ue(),Fe(),a.jsxs(a.Fragment,{children:[a.jsxs(De,{isOpen:!h&&!t&&e!==null,title:"Disconnected",className:"disconnected-modal",children:[a.jsx("div",{children:(()=>{if(e===null)return null;switch(e.errCode){case L.CONNECTION_ERROR:case L.AUTH_ERROR:return a.jsx(a.Fragment,{children:"Unable to connect to the server."});case L.TEAM_TEMP_BLOCKED:return a.jsx(a.Fragment,{children:"The site is down for maintenance."});default:return a.jsx(a.Fragment,{children:"Sorry, something went wrong."})}})()}),a.jsxs("div",{children:["You will not be able to receive notifications, submit answers, or load new content while disconnected. Please monitor your email or"," ",a.jsx("a",{href:"https://bsky.app/profile/galacticpuzzlehunt.com",children:"our Bluesky account"})," ","for updates, and refresh the page at a later time to try reconnecting."]}),a.jsx("div",{children:a.jsx("button",{onClick:()=>o(!0),children:"OK"})})]}),a.jsx(Me,{}),a.jsx(tt,{getKey:u=>u.pathname})]})}const ft=Ke([{path:"/",element:a.jsx(dt,{}),errorElement:a.jsx(it,{}),children:[{element:a.jsx(ct,{}),children:[{element:a.jsx(_e,{}),children:Object.values(Ne)},...Object.values(Oe)]},{path:"admin",element:a.jsx(ze,{})},...Object.values(Ie)]}]);function mt(){return a.jsx(Qe,{router:ft})}export{mt as default};
//# sourceMappingURL=App-Bqxn8ydl.js.map
